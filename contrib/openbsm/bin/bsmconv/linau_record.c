#include <sys/types.h>
#include <sys/sbuf.h>

#include <ctype.h>
#include <errno.h>
#include <stdbool.h>
#include <stdio.h>
#include <stdlib.h>
#include <string.h>

#include <bsm/libbsm.h>

#include "linau.h"
#include "linau_common.h"
#include "linau_impl.h"
#include "pjdlog.h"

#define	BSMCONV_LINAU_RECORD_INPUT_BUFFER_SIZE	16
#define	BSMCONV_LINAU_RECORD_UINT_BUFFER_SIZE	32

#define	GET_NUM_ARGS(...) (sizeof((int[]){__VA_ARGS__})/sizeof(int))
#define	PREPEND_NUM_ARGS(...) GET_NUM_ARGS(__VA_ARGS__), __VA_ARGS__

static int get_linau_type_num(const char *type);
static void convert_to_au(int aurecordd, const struct linau_record *record,
    int typenum);
static const char *field_name_from_field_name_id(int fieldnameid);

static uint32_t extract_uint32(const char *buf, size_t start, size_t end);
static uint32_t string_to_uint32(const char *str);

/*
 * XXX Should I change those if's to else if's?
 *
 * XXX And how about using this macro instead:
 * #define	STRING_CMP(str1, str2, retval) do {			\
 *         if (strcmp((str1), (str2)) == 0)				\
 *                 return ((retval));					\
 * } while(0);								\
 *
 * Mariusz says that I should use else if's but I am not fully convinced yet.
 * else if's would damage the readability due to the presence of the commented
 * out deprecated defines like LINAU_TYPE_GET_STR.
 */
static int
get_linau_type_num(const char *type)
{

	PJDLOG_ASSERT(type != NULL);

	/* if (strcmp(LINAU_TYPE_GET_STR, type) == 0) */
	/*         return (LINAU_TYPE_GET); */
	/* if (strcmp(LINAU_TYPE_SET_STR, type) == 0) */
	/*         return (LINAU_TYPE_SET); */
	/* if (strcmp(LINAU_TYPE_LIST_STR, type) == 0) */
	/*         return (LINAU_TYPE_LIST); */
	/* if (strcmp(LINAU_TYPE_ADD_STR, type) == 0) */
	/*         return (LINAU_TYPE_ADD); */
	/* if (strcmp(LINAU_TYPE_DEL_STR, type) == 0) */
	/*         return (LINAU_TYPE_DEL); */
	if (strcmp(LINAU_TYPE_USER_STR, type) == 0)
		return (LINAU_TYPE_USER);
	if (strcmp(LINAU_TYPE_LOGIN_STR, type) == 0)
		return (LINAU_TYPE_LOGIN);
	/* if (strcmp(LINAU_TYPE_SIGNAL_INFO_STR, type) == 0) */
	/*         return (LINAU_TYPE_SIGNAL_INFO); */
	/* if (strcmp(LINAU_TYPE_ADD_RULE_STR, type) == 0) */
	/*         return (LINAU_TYPE_ADD_RULE); */
	/* if (strcmp(LINAU_TYPE_DEL_RULE_STR, type) == 0) */
	/*         return (LINAU_TYPE_DEL_RULE); */
	/* if (strcmp(LINAU_TYPE_LIST_RULES_STR, type) == 0) */
	/*         return (LINAU_TYPE_LIST_RULES); */
	/* if (strcmp(LINAU_TYPE_TRIM_STR, type) == 0) */
	/*         return (LINAU_TYPE_TRIM); */
	/* if (strcmp(LINAU_TYPE_MAKE_EQUIV_STR, type) == 0) */
	/*         return (LINAU_TYPE_MAKE_EQUIV); */
	/* if (strcmp(LINAU_TYPE_TTY_GET_STR, type) == 0) */
	/*         return (LINAU_TYPE_TTY_GET); */
	/* if (strcmp(LINAU_TYPE_TTY_SET_STR, type) == 0) */
	/*         return (LINAU_TYPE_TTY_SET); */
	/* if (strcmp(LINAU_TYPE_SET_FEATURE_STR, type) == 0) */
	/*         return (LINAU_TYPE_SET_FEATURE); */
	/* if (strcmp(LINAU_TYPE_GET_FEATURE_STR, type) == 0) */
	/*         return (LINAU_TYPE_GET_FEATURE); */
	if (strcmp(LINAU_TYPE_USER_AUTH_STR, type) == 0)
		return (LINAU_TYPE_USER_AUTH);
	if (strcmp(LINAU_TYPE_USER_ACCT_STR, type) == 0)
		return (LINAU_TYPE_USER_ACCT);
	if (strcmp(LINAU_TYPE_USER_MGMT_STR, type) == 0)
		return (LINAU_TYPE_USER_MGMT);
	if (strcmp(LINAU_TYPE_CRED_ACQ_STR, type) == 0)
		return (LINAU_TYPE_CRED_ACQ);
	if (strcmp(LINAU_TYPE_CRED_DISP_STR, type) == 0)
		return (LINAU_TYPE_CRED_DISP);
	if (strcmp(LINAU_TYPE_USER_START_STR, type) == 0)
		return (LINAU_TYPE_USER_START);
	if (strcmp(LINAU_TYPE_USER_END_STR, type) == 0)
		return (LINAU_TYPE_USER_END);
	if (strcmp(LINAU_TYPE_USER_AVC_STR, type) == 0)
		return (LINAU_TYPE_USER_AVC);
	if (strcmp(LINAU_TYPE_USER_CHAUTHTOK_STR, type) == 0)
		return (LINAU_TYPE_USER_CHAUTHTOK);
	if (strcmp(LINAU_TYPE_USER_ERR_STR, type) == 0)
		return (LINAU_TYPE_USER_ERR);
	if (strcmp(LINAU_TYPE_CRED_REFR_STR, type) == 0)
		return (LINAU_TYPE_CRED_REFR);
	if (strcmp(LINAU_TYPE_USYS_CONFIG_STR, type) == 0)
		return (LINAU_TYPE_USYS_CONFIG);
	if (strcmp(LINAU_TYPE_USER_LOGIN_STR, type) == 0)
		return (LINAU_TYPE_USER_LOGIN);
	if (strcmp(LINAU_TYPE_USER_LOGOUT_STR, type) == 0)
		return (LINAU_TYPE_USER_LOGOUT);
	if (strcmp(LINAU_TYPE_ADD_USER_STR, type) == 0)
		return (LINAU_TYPE_ADD_USER);
	if (strcmp(LINAU_TYPE_DEL_USER_STR, type) == 0)
		return (LINAU_TYPE_DEL_USER);
	if (strcmp(LINAU_TYPE_ADD_GROUP_STR, type) == 0)
		return (LINAU_TYPE_ADD_GROUP);
	if (strcmp(LINAU_TYPE_DEL_GROUP_STR, type) == 0)
		return (LINAU_TYPE_DEL_GROUP);
	if (strcmp(LINAU_TYPE_DAC_CHECK_STR, type) == 0)
		return (LINAU_TYPE_DAC_CHECK);
	if (strcmp(LINAU_TYPE_CHGRP_ID_STR, type) == 0)
		return (LINAU_TYPE_CHGRP_ID);
	if (strcmp(LINAU_TYPE_TEST_STR, type) == 0)
		return (LINAU_TYPE_TEST);
	if (strcmp(LINAU_TYPE_TRUSTED_APP_STR, type) == 0)
		return (LINAU_TYPE_TRUSTED_APP);
	if (strcmp(LINAU_TYPE_USER_SELINUX_ERR_STR, type) == 0)
		return (LINAU_TYPE_USER_SELINUX_ERR);
	if (strcmp(LINAU_TYPE_USER_CMD_STR, type) == 0)
		return (LINAU_TYPE_USER_CMD);
	if (strcmp(LINAU_TYPE_USER_TTY_STR, type) == 0)
		return (LINAU_TYPE_USER_TTY);
	if (strcmp(LINAU_TYPE_CHUSER_ID_STR, type) == 0)
		return (LINAU_TYPE_CHUSER_ID);
	if (strcmp(LINAU_TYPE_GRP_AUTH_STR, type) == 0)
		return (LINAU_TYPE_GRP_AUTH);
	if (strcmp(LINAU_TYPE_MAC_CHECK_STR, type) == 0)
		return (LINAU_TYPE_MAC_CHECK);
	if (strcmp(LINAU_TYPE_ACCT_LOCK_STR, type) == 0)
		return (LINAU_TYPE_ACCT_LOCK);
	if (strcmp(LINAU_TYPE_ACCT_UNLOCK_STR, type) == 0)
		return (LINAU_TYPE_ACCT_UNLOCK);
	if (strcmp(LINAU_TYPE_SYSTEM_BOOT_STR, type) == 0)
		return (LINAU_TYPE_SYSTEM_BOOT);
	if (strcmp(LINAU_TYPE_SYSTEM_SHUTDOWN_STR, type) == 0)
		return (LINAU_TYPE_SYSTEM_SHUTDOWN);
	if (strcmp(LINAU_TYPE_SYSTEM_RUNLEVEL_STR, type) == 0)
		return (LINAU_TYPE_SYSTEM_RUNLEVEL);
	if (strcmp(LINAU_TYPE_SERVICE_START_STR, type) == 0)
		return (LINAU_TYPE_SERVICE_START);
	if (strcmp(LINAU_TYPE_SERVICE_STOP_STR, type) == 0)
		return (LINAU_TYPE_SERVICE_STOP);
	if (strcmp(LINAU_TYPE_GRP_MGMT_STR, type) == 0)
		return (LINAU_TYPE_GRP_MGMT);
	if (strcmp(LINAU_TYPE_GRP_CHAUTHTOK_STR, type) == 0)
		return (LINAU_TYPE_GRP_CHAUTHTOK);
	if (strcmp(LINAU_TYPE_DAEMON_START_STR, type) == 0)
		return (LINAU_TYPE_DAEMON_START);
	if (strcmp(LINAU_TYPE_DAEMON_END_STR, type) == 0)
		return (LINAU_TYPE_DAEMON_END);
	if (strcmp(LINAU_TYPE_DAEMON_ABORT_STR, type) == 0)
		return (LINAU_TYPE_DAEMON_ABORT);
	if (strcmp(LINAU_TYPE_DAEMON_CONFIG_STR, type) == 0)
		return (LINAU_TYPE_DAEMON_CONFIG);
	/* if (strcmp(LINAU_TYPE_DAEMON_RECONFIG_STR, type) == 0) */
	/*         return (LINAU_TYPE_DAEMON_RECONFIG); */
	if (strcmp(LINAU_TYPE_DAEMON_ROTATE_STR, type) == 0)
		return (LINAU_TYPE_DAEMON_ROTATE);
	if (strcmp(LINAU_TYPE_DAEMON_RESUME_STR, type) == 0)
		return (LINAU_TYPE_DAEMON_RESUME);
	if (strcmp(LINAU_TYPE_DAEMON_ACCEPT_STR, type) == 0)
		return (LINAU_TYPE_DAEMON_ACCEPT);
	if (strcmp(LINAU_TYPE_DAEMON_CLOSE_STR, type) == 0)
		return (LINAU_TYPE_DAEMON_CLOSE);
	if (strcmp(LINAU_TYPE_DAEMON_ERR_STR, type) == 0)
		return (LINAU_TYPE_DAEMON_ERR);
	if (strcmp(LINAU_TYPE_SYSCALL_STR, type) == 0)
		return (LINAU_TYPE_SYSCALL);
	/* if (strcmp(LINAU_TYPE_FS_WATCH_STR, type) == 0) */
	/*         return (LINAU_TYPE_FS_WATCH); */
	if (strcmp(LINAU_TYPE_PATH_STR, type) == 0)
		return (LINAU_TYPE_PATH);
	if (strcmp(LINAU_TYPE_IPC_STR, type) == 0)
		return (LINAU_TYPE_IPC);
	if (strcmp(LINAU_TYPE_SOCKETCALL_STR, type) == 0)
		return (LINAU_TYPE_SOCKETCALL);
	if (strcmp(LINAU_TYPE_CONFIG_CHANGE_STR, type) == 0)
		return (LINAU_TYPE_CONFIG_CHANGE);
	if (strcmp(LINAU_TYPE_SOCKADDR_STR, type) == 0)
		return (LINAU_TYPE_SOCKADDR);
	if (strcmp(LINAU_TYPE_CWD_STR, type) == 0)
		return (LINAU_TYPE_CWD);
	/* if (strcmp(LINAU_TYPE_FS_INODE_STR, type) == 0) */
	/*         return (LINAU_TYPE_FS_INODE); */
	if (strcmp(LINAU_TYPE_EXECVE_STR, type) == 0)
		return (LINAU_TYPE_EXECVE);
	if (strcmp(LINAU_TYPE_IPC_SET_PERM_STR, type) == 0)
		return (LINAU_TYPE_IPC_SET_PERM);
	if (strcmp(LINAU_TYPE_MQ_OPEN_STR, type) == 0)
		return (LINAU_TYPE_MQ_OPEN);
	if (strcmp(LINAU_TYPE_MQ_SENDRECV_STR, type) == 0)
		return (LINAU_TYPE_MQ_SENDRECV);
	if (strcmp(LINAU_TYPE_MQ_NOTIFY_STR, type) == 0)
		return (LINAU_TYPE_MQ_NOTIFY);
	if (strcmp(LINAU_TYPE_MQ_GETSETATTR_STR, type) == 0)
		return (LINAU_TYPE_MQ_GETSETATTR);
	if (strcmp(LINAU_TYPE_KERNEL_OTHER_STR, type) == 0)
		return (LINAU_TYPE_KERNEL_OTHER);
	if (strcmp(LINAU_TYPE_FD_PAIR_STR, type) == 0)
		return (LINAU_TYPE_FD_PAIR);
	if (strcmp(LINAU_TYPE_OBJ_PID_STR, type) == 0)
		return (LINAU_TYPE_OBJ_PID);
	if (strcmp(LINAU_TYPE_TTY_STR, type) == 0)
		return (LINAU_TYPE_TTY);
	if (strcmp(LINAU_TYPE_EOE_STR, type) == 0)
		return (LINAU_TYPE_EOE);
	if (strcmp(LINAU_TYPE_BPRM_FCAPS_STR, type) == 0)
		return (LINAU_TYPE_BPRM_FCAPS);
	if (strcmp(LINAU_TYPE_CAPSET_STR, type) == 0)
		return (LINAU_TYPE_CAPSET);
	if (strcmp(LINAU_TYPE_MMAP_STR, type) == 0)
		return (LINAU_TYPE_MMAP);
	if (strcmp(LINAU_TYPE_NETFILTER_PKT_STR, type) == 0)
		return (LINAU_TYPE_NETFILTER_PKT);
	if (strcmp(LINAU_TYPE_NETFILTER_CFG_STR, type) == 0)
		return (LINAU_TYPE_NETFILTER_CFG);
	if (strcmp(LINAU_TYPE_SECCOMP_STR, type) == 0)
		return (LINAU_TYPE_SECCOMP);
	if (strcmp(LINAU_TYPE_PROCTITLE_STR, type) == 0)
		return (LINAU_TYPE_PROCTITLE);
	if (strcmp(LINAU_TYPE_FEATURE_CHANGE_STR, type) == 0)
		return (LINAU_TYPE_FEATURE_CHANGE);
	if (strcmp(LINAU_TYPE_AVC_STR, type) == 0)
		return (LINAU_TYPE_AVC);
	if (strcmp(LINAU_TYPE_SELINUX_ERR_STR, type) == 0)
		return (LINAU_TYPE_SELINUX_ERR);
	if (strcmp(LINAU_TYPE_AVC_PATH_STR, type) == 0)
		return (LINAU_TYPE_AVC_PATH);
	if (strcmp(LINAU_TYPE_MAC_POLICY_LOAD_STR, type) == 0)
		return (LINAU_TYPE_MAC_POLICY_LOAD);
	if (strcmp(LINAU_TYPE_MAC_STATUS_STR, type) == 0)
		return (LINAU_TYPE_MAC_STATUS);
	if (strcmp(LINAU_TYPE_MAC_CONFIG_CHANGE_STR, type) == 0)
		return (LINAU_TYPE_MAC_CONFIG_CHANGE);
	if (strcmp(LINAU_TYPE_MAC_UNLBL_ALLOW_STR, type) == 0)
		return (LINAU_TYPE_MAC_UNLBL_ALLOW);
	if (strcmp(LINAU_TYPE_MAC_CIPSOV4_ADD_STR, type) == 0)
		return (LINAU_TYPE_MAC_CIPSOV4_ADD);
	if (strcmp(LINAU_TYPE_MAC_CIPSOV4_DEL_STR, type) == 0)
		return (LINAU_TYPE_MAC_CIPSOV4_DEL);
	if (strcmp(LINAU_TYPE_MAC_MAP_ADD_STR, type) == 0)
		return (LINAU_TYPE_MAC_MAP_ADD);
	if (strcmp(LINAU_TYPE_MAC_MAP_DEL_STR, type) == 0)
		return (LINAU_TYPE_MAC_MAP_DEL);
	if (strcmp(LINAU_TYPE_MAC_IPSEC_ADDSA_STR, type) == 0)
		return (LINAU_TYPE_MAC_IPSEC_ADDSA);
	if (strcmp(LINAU_TYPE_MAC_IPSEC_DELSA_STR, type) == 0)
		return (LINAU_TYPE_MAC_IPSEC_DELSA);
	if (strcmp(LINAU_TYPE_MAC_IPSEC_ADDSPD_STR, type) == 0)
		return (LINAU_TYPE_MAC_IPSEC_ADDSPD);
	if (strcmp(LINAU_TYPE_MAC_IPSEC_DELSPD_STR, type) == 0)
		return (LINAU_TYPE_MAC_IPSEC_DELSPD);
	if (strcmp(LINAU_TYPE_MAC_IPSEC_EVENT_STR, type) == 0)
		return (LINAU_TYPE_MAC_IPSEC_EVENT);
	if (strcmp(LINAU_TYPE_MAC_UNLBL_STCADD_STR, type) == 0)
		return (LINAU_TYPE_MAC_UNLBL_STCADD);
	if (strcmp(LINAU_TYPE_MAC_UNLBL_STCDEL_STR, type) == 0)
		return (LINAU_TYPE_MAC_UNLBL_STCDEL);
	if (strcmp(LINAU_TYPE_ANOM_PROMISCUOUS_STR, type) == 0)
		return (LINAU_TYPE_ANOM_PROMISCUOUS);
	if (strcmp(LINAU_TYPE_ANOM_ABEND_STR, type) == 0)
		return (LINAU_TYPE_ANOM_ABEND);
	if (strcmp(LINAU_TYPE_ANOM_LINK_STR, type) == 0)
		return (LINAU_TYPE_ANOM_LINK);
	if (strcmp(LINAU_TYPE_INTEGRITY_DATA_STR, type) == 0)
		return (LINAU_TYPE_INTEGRITY_DATA);
	if (strcmp(LINAU_TYPE_INTEGRITY_METADATA_STR, type) == 0)
		return (LINAU_TYPE_INTEGRITY_METADATA);
	if (strcmp(LINAU_TYPE_INTEGRITY_STATUS_STR, type) == 0)
		return (LINAU_TYPE_INTEGRITY_STATUS);
	if (strcmp(LINAU_TYPE_INTEGRITY_HASH_STR, type) == 0)
		return (LINAU_TYPE_INTEGRITY_HASH);
	if (strcmp(LINAU_TYPE_INTEGRITY_PCR_STR, type) == 0)
		return (LINAU_TYPE_INTEGRITY_PCR);
	if (strcmp(LINAU_TYPE_INTEGRITY_RULE_STR, type) == 0)
		return (LINAU_TYPE_INTEGRITY_RULE);
	if (strcmp(LINAU_TYPE_AA_STR, type) == 0)
		return (LINAU_TYPE_AA);
	if (strcmp(LINAU_TYPE_APPARMOR_AUDIT_STR, type) == 0)
		return (LINAU_TYPE_APPARMOR_AUDIT);
	if (strcmp(LINAU_TYPE_APPARMOR_ALLOWED_STR, type) == 0)
		return (LINAU_TYPE_APPARMOR_ALLOWED);
	if (strcmp(LINAU_TYPE_APPARMOR_DENIED_STR, type) == 0)
		return (LINAU_TYPE_APPARMOR_DENIED);
	if (strcmp(LINAU_TYPE_APPARMOR_HINT_STR, type) == 0)
		return (LINAU_TYPE_APPARMOR_HINT);
	if (strcmp(LINAU_TYPE_APPARMOR_STATUS_STR, type) == 0)
		return (LINAU_TYPE_APPARMOR_STATUS);
	if (strcmp(LINAU_TYPE_APPARMOR_ERROR_STR, type) == 0)
		return (LINAU_TYPE_APPARMOR_ERROR);
	if (strcmp(LINAU_TYPE_KERNEL_STR, type) == 0)
		return (LINAU_TYPE_KERNEL);
	if (strcmp(LINAU_TYPE_ANOM_LOGIN_FAILURES_STR, type) == 0)
		return (LINAU_TYPE_ANOM_LOGIN_FAILURES);
	if (strcmp(LINAU_TYPE_ANOM_LOGIN_TIME_STR, type) == 0)
		return (LINAU_TYPE_ANOM_LOGIN_TIME);
	if (strcmp(LINAU_TYPE_ANOM_LOGIN_SESSIONS_STR, type) == 0)
		return (LINAU_TYPE_ANOM_LOGIN_SESSIONS);
	if (strcmp(LINAU_TYPE_ANOM_LOGIN_ACCT_STR, type) == 0)
		return (LINAU_TYPE_ANOM_LOGIN_ACCT);
	if (strcmp(LINAU_TYPE_ANOM_LOGIN_LOCATION_STR, type) == 0)
		return (LINAU_TYPE_ANOM_LOGIN_LOCATION);
	if (strcmp(LINAU_TYPE_ANOM_MAX_DAC_STR, type) == 0)
		return (LINAU_TYPE_ANOM_MAX_DAC);
	if (strcmp(LINAU_TYPE_ANOM_MAX_MAC_STR, type) == 0)
		return (LINAU_TYPE_ANOM_MAX_MAC);
	if (strcmp(LINAU_TYPE_ANOM_AMTU_FAIL_STR, type) == 0)
		return (LINAU_TYPE_ANOM_AMTU_FAIL);
	if (strcmp(LINAU_TYPE_ANOM_RBAC_FAIL_STR, type) == 0)
		return (LINAU_TYPE_ANOM_RBAC_FAIL);
	if (strcmp(LINAU_TYPE_ANOM_RBAC_INTEGRITY_FAIL_STR, type) == 0)
		return (LINAU_TYPE_ANOM_RBAC_INTEGRITY_FAIL);
	if (strcmp(LINAU_TYPE_ANOM_CRYPTO_FAIL_STR, type) == 0)
		return (LINAU_TYPE_ANOM_CRYPTO_FAIL);
	if (strcmp(LINAU_TYPE_ANOM_ACCESS_FS_STR, type) == 0)
		return (LINAU_TYPE_ANOM_ACCESS_FS);
	if (strcmp(LINAU_TYPE_ANOM_EXEC_STR, type) == 0)
		return (LINAU_TYPE_ANOM_EXEC);
	if (strcmp(LINAU_TYPE_ANOM_MK_EXEC_STR, type) == 0)
		return (LINAU_TYPE_ANOM_MK_EXEC);
	if (strcmp(LINAU_TYPE_ANOM_ADD_ACCT_STR, type) == 0)
		return (LINAU_TYPE_ANOM_ADD_ACCT);
	if (strcmp(LINAU_TYPE_ANOM_DEL_ACCT_STR, type) == 0)
		return (LINAU_TYPE_ANOM_DEL_ACCT);
	if (strcmp(LINAU_TYPE_ANOM_MOD_ACCT_STR, type) == 0)
		return (LINAU_TYPE_ANOM_MOD_ACCT);
	if (strcmp(LINAU_TYPE_ANOM_ROOT_TRANS_STR, type) == 0)
		return (LINAU_TYPE_ANOM_ROOT_TRANS);
	if (strcmp(LINAU_TYPE_RESP_ANOMALY_STR, type) == 0)
		return (LINAU_TYPE_RESP_ANOMALY);
	if (strcmp(LINAU_TYPE_RESP_ALERT_STR, type) == 0)
		return (LINAU_TYPE_RESP_ALERT);
	if (strcmp(LINAU_TYPE_RESP_KILL_PROC_STR, type) == 0)
		return (LINAU_TYPE_RESP_KILL_PROC);
	if (strcmp(LINAU_TYPE_RESP_TERM_ACCESS_STR, type) == 0)
		return (LINAU_TYPE_RESP_TERM_ACCESS);
	if (strcmp(LINAU_TYPE_RESP_ACCT_REMOTE_STR, type) == 0)
		return (LINAU_TYPE_RESP_ACCT_REMOTE);
	if (strcmp(LINAU_TYPE_RESP_ACCT_LOCK_TIMED_STR, type) == 0)
		return (LINAU_TYPE_RESP_ACCT_LOCK_TIMED);
	if (strcmp(LINAU_TYPE_RESP_ACCT_UNLOCK_TIMED_STR, type) == 0)
		return (LINAU_TYPE_RESP_ACCT_UNLOCK_TIMED);
	if (strcmp(LINAU_TYPE_RESP_ACCT_LOCK_STR, type) == 0)
		return (LINAU_TYPE_RESP_ACCT_LOCK);
	if (strcmp(LINAU_TYPE_RESP_TERM_LOCK_STR, type) == 0)
		return (LINAU_TYPE_RESP_TERM_LOCK);
	if (strcmp(LINAU_TYPE_RESP_SEBOOL_STR, type) == 0)
		return (LINAU_TYPE_RESP_SEBOOL);
	if (strcmp(LINAU_TYPE_RESP_EXEC_STR, type) == 0)
		return (LINAU_TYPE_RESP_EXEC);
	if (strcmp(LINAU_TYPE_RESP_SINGLE_STR, type) == 0)
		return (LINAU_TYPE_RESP_SINGLE);
	if (strcmp(LINAU_TYPE_RESP_HALT_STR, type) == 0)
		return (LINAU_TYPE_RESP_HALT);
	if (strcmp(LINAU_TYPE_USER_ROLE_CHANGE_STR, type) == 0)
		return (LINAU_TYPE_USER_ROLE_CHANGE);
	if (strcmp(LINAU_TYPE_ROLE_ASSIGN_STR, type) == 0)
		return (LINAU_TYPE_ROLE_ASSIGN);
	if (strcmp(LINAU_TYPE_ROLE_REMOVE_STR, type) == 0)
		return (LINAU_TYPE_ROLE_REMOVE);
	if (strcmp(LINAU_TYPE_LABEL_OVERRIDE_STR, type) == 0)
		return (LINAU_TYPE_LABEL_OVERRIDE);
	if (strcmp(LINAU_TYPE_LABEL_LEVEL_CHANGE_STR, type) == 0)
		return (LINAU_TYPE_LABEL_LEVEL_CHANGE);
	if (strcmp(LINAU_TYPE_USER_LABELED_EXPORT_STR, type) == 0)
		return (LINAU_TYPE_USER_LABELED_EXPORT);
	if (strcmp(LINAU_TYPE_USER_UNLABELED_EXPORT_STR, type) == 0)
		return (LINAU_TYPE_USER_UNLABELED_EXPORT);
	if (strcmp(LINAU_TYPE_DEV_ALLOC_STR, type) == 0)
		return (LINAU_TYPE_DEV_ALLOC);
	if (strcmp(LINAU_TYPE_DEV_DEALLOC_STR, type) == 0)
		return (LINAU_TYPE_DEV_DEALLOC);
	if (strcmp(LINAU_TYPE_FS_RELABEL_STR, type) == 0)
		return (LINAU_TYPE_FS_RELABEL);
	if (strcmp(LINAU_TYPE_USER_MAC_POLICY_LOAD_STR, type) == 0)
		return (LINAU_TYPE_USER_MAC_POLICY_LOAD);
	if (strcmp(LINAU_TYPE_ROLE_MODIFY_STR, type) == 0)
		return (LINAU_TYPE_ROLE_MODIFY);
	if (strcmp(LINAU_TYPE_USER_MAC_CONFIG_CHANGE_STR, type) == 0)
		return (LINAU_TYPE_USER_MAC_CONFIG_CHANGE);
	if (strcmp(LINAU_TYPE_CRYPTO_TEST_USER_STR, type) == 0)
		return (LINAU_TYPE_CRYPTO_TEST_USER);
	if (strcmp(LINAU_TYPE_CRYPTO_PARAM_CHANGE_USER_STR, type) == 0)
		return (LINAU_TYPE_CRYPTO_PARAM_CHANGE_USER);
	if (strcmp(LINAU_TYPE_CRYPTO_LOGIN_STR, type) == 0)
		return (LINAU_TYPE_CRYPTO_LOGIN);
	if (strcmp(LINAU_TYPE_CRYPTO_LOGOUT_STR, type) == 0)
		return (LINAU_TYPE_CRYPTO_LOGOUT);
	if (strcmp(LINAU_TYPE_CRYPTO_KEY_USER_STR, type) == 0)
		return (LINAU_TYPE_CRYPTO_KEY_USER);
	if (strcmp(LINAU_TYPE_CRYPTO_FAILURE_USER_STR, type) == 0)
		return (LINAU_TYPE_CRYPTO_FAILURE_USER);
	if (strcmp(LINAU_TYPE_CRYPTO_REPLAY_USER_STR, type) == 0)
		return (LINAU_TYPE_CRYPTO_REPLAY_USER);
	if (strcmp(LINAU_TYPE_CRYPTO_SESSION_STR, type) == 0)
		return (LINAU_TYPE_CRYPTO_SESSION);
	if (strcmp(LINAU_TYPE_CRYPTO_IKE_SA_STR, type) == 0)
		return (LINAU_TYPE_CRYPTO_IKE_SA);
	if (strcmp(LINAU_TYPE_CRYPTO_IPSEC_SA_STR, type) == 0)
		return (LINAU_TYPE_CRYPTO_IPSEC_SA);
	if (strcmp(LINAU_TYPE_VIRT_CONTROL_STR, type) == 0)
		return (LINAU_TYPE_VIRT_CONTROL);
	if (strcmp(LINAU_TYPE_VIRT_RESOURCE_STR, type) == 0)
		return (LINAU_TYPE_VIRT_RESOURCE);
	if (strcmp(LINAU_TYPE_VIRT_MACHINE_ID_STR, type) == 0)
		return (LINAU_TYPE_VIRT_MACHINE_ID);

	return (LINAU_TYPE_UNDEFINED);
}

static void
convert_to_au(int aurecordd, const struct linau_record *record, int typenum)
{
	token_t *tok;
	size_t availablefields;

	PJDLOG_ASSERT(record != NULL);
	PJDLOG_ASSERT(aurecordd >= 0);

	availablefields = 0;

	switch (typenum) {
	case LINAU_TYPE_UNDEFINED:
		/* FALLTHROUGH */
	/* case LINAU_TYPE_GET: */
	/* case LINAU_TYPE_SET: */
	/* case LINAU_TYPE_LIST: */
	/* case LINAU_TYPE_ADD: */
	/* case LINAU_TYPE_DEL: */
	case LINAU_TYPE_USER:
		/* FALLTHROUGH */
	case LINAU_TYPE_LOGIN:
		/* FALLTHROUGH */
	/* case LINAU_TYPE_SIGNAL_INFO: */
	/* case LINAU_TYPE_ADD_RULE: */
	/* case LINAU_TYPE_DEL_RULE: */
	/* case LINAU_TYPE_LIST_RULES: */
	/* case LINAU_TYPE_TRIM: */
	/* case LINAU_TYPE_MAKE_EQUIV: */
	/* case LINAU_TYPE_TTY_GET: */
	/* case LINAU_TYPE_TTY_SET: */
	/* case LINAU_TYPE_SET_FEATURE: */
	/* case LINAU_TYPE_GET_FEATURE: */
	case LINAU_TYPE_USER_AUTH:
		/* FALLTHROUGH */
	case LINAU_TYPE_USER_ACCT:
		/* FALLTHROUGH */
	case LINAU_TYPE_USER_MGMT:
		/* FALLTHROUGH */
	case LINAU_TYPE_CRED_ACQ:
		/* FALLTHROUGH */
	case LINAU_TYPE_CRED_DISP:
		/* FALLTHROUGH */
	case LINAU_TYPE_USER_START:
		/* FALLTHROUGH */
	case LINAU_TYPE_USER_END:
		/* FALLTHROUGH */
	case LINAU_TYPE_USER_AVC:
		/* FALLTHROUGH */
	case LINAU_TYPE_USER_CHAUTHTOK:
		/* FALLTHROUGH */
	case LINAU_TYPE_USER_ERR:
		/* FALLTHROUGH */
	case LINAU_TYPE_CRED_REFR:
		/* FALLTHROUGH */
	case LINAU_TYPE_USYS_CONFIG:
		/* FALLTHROUGH */
	case LINAU_TYPE_USER_LOGIN:
		/* FALLTHROUGH */
	case LINAU_TYPE_USER_LOGOUT:
		/* FALLTHROUGH */
	case LINAU_TYPE_ADD_USER:
		/* FALLTHROUGH */
	case LINAU_TYPE_DEL_USER:
		/* FALLTHROUGH */
	case LINAU_TYPE_ADD_GROUP:
		/* FALLTHROUGH */
	case LINAU_TYPE_DEL_GROUP:
		/* FALLTHROUGH */
	case LINAU_TYPE_DAC_CHECK:
		/* FALLTHROUGH */
	case LINAU_TYPE_CHGRP_ID:
		/* FALLTHROUGH */
	case LINAU_TYPE_TEST:
		/* FALLTHROUGH */
	case LINAU_TYPE_TRUSTED_APP:
		/* FALLTHROUGH */
	case LINAU_TYPE_USER_SELINUX_ERR:
		/* FALLTHROUGH */
	case LINAU_TYPE_USER_CMD:
		/* Check existance of the required fields. */
		(void)field_name_from_field_name_id(1);

		; // TODO
//		if (availablefields != linau_record_get_fields_count(record)) {
//			/* Genereate a text token. */
//			; //TODO
//		} else {
//			/* Genereate tokens. */
//			; //TODO
//		}
		break;

	case LINAU_TYPE_USER_TTY:
		/* FALLTHROUGH */
	case LINAU_TYPE_CHUSER_ID:
		/* FALLTHROUGH */
	case LINAU_TYPE_GRP_AUTH:
		/* FALLTHROUGH */
	case LINAU_TYPE_MAC_CHECK:
		/* FALLTHROUGH */
	case LINAU_TYPE_ACCT_LOCK:
		/* FALLTHROUGH */
	case LINAU_TYPE_ACCT_UNLOCK:
		/* FALLTHROUGH */
	case LINAU_TYPE_SYSTEM_BOOT:
		/* FALLTHROUGH */
	case LINAU_TYPE_SYSTEM_SHUTDOWN:
		/* FALLTHROUGH */
	case LINAU_TYPE_SYSTEM_RUNLEVEL:
		/* FALLTHROUGH */
	case LINAU_TYPE_SERVICE_START:
		/* FALLTHROUGH */
	case LINAU_TYPE_SERVICE_STOP:
		/* FALLTHROUGH */
	case LINAU_TYPE_GRP_MGMT:
		/* FALLTHROUGH */
	case LINAU_TYPE_GRP_CHAUTHTOK:
		/* FALLTHROUGH */
	case LINAU_TYPE_DAEMON_START:
		/* FALLTHROUGH */
	case LINAU_TYPE_DAEMON_END:
		/* FALLTHROUGH */
	case LINAU_TYPE_DAEMON_ABORT:
		/* FALLTHROUGH */
	case LINAU_TYPE_DAEMON_CONFIG:
		/* FALLTHROUGH */
	/* case LINAU_TYPE_DAEMON_RECONFIG: */
	case LINAU_TYPE_DAEMON_ROTATE:
		/* FALLTHROUGH */
	case LINAU_TYPE_DAEMON_RESUME:
		/* FALLTHROUGH */
	case LINAU_TYPE_DAEMON_ACCEPT:
		/* FALLTHROUGH */
	case LINAU_TYPE_DAEMON_CLOSE:
		/* FALLTHROUGH */
	case LINAU_TYPE_DAEMON_ERR:
		/* FALLTHROUGH */
	case LINAU_TYPE_SYSCALL:
		/* FALLTHROUGH */
	/* case LINAU_TYPE_FS_WATCH: */
	case LINAU_TYPE_PATH:
		/* FALLTHROUGH */
	case LINAU_TYPE_IPC:
		/* FALLTHROUGH */
	case LINAU_TYPE_SOCKETCALL:
		/* FALLTHROUGH */
	case LINAU_TYPE_CONFIG_CHANGE:
		/* FALLTHROUGH */
	case LINAU_TYPE_SOCKADDR:
		/* FALLTHROUGH */
	case LINAU_TYPE_CWD:
		/* FALLTHROUGH */
	/* case LINAU_TYPE_FS_INODE: */
	case LINAU_TYPE_EXECVE:
		/* FALLTHROUGH */
	case LINAU_TYPE_IPC_SET_PERM:
		/* FALLTHROUGH */
	case LINAU_TYPE_MQ_OPEN:
		/* FALLTHROUGH */
	case LINAU_TYPE_MQ_SENDRECV:
		/* FALLTHROUGH */
	case LINAU_TYPE_MQ_NOTIFY:
		/* FALLTHROUGH */
	case LINAU_TYPE_MQ_GETSETATTR:
		/* FALLTHROUGH */
	case LINAU_TYPE_KERNEL_OTHER:
		/* FALLTHROUGH */
	case LINAU_TYPE_FD_PAIR:
		/* FALLTHROUGH */
	case LINAU_TYPE_OBJ_PID:
		/* FALLTHROUGH */
	case LINAU_TYPE_TTY:
		/* FALLTHROUGH */
	case LINAU_TYPE_EOE:
		/* FALLTHROUGH */
	case LINAU_TYPE_BPRM_FCAPS:
		/* FALLTHROUGH */
	case LINAU_TYPE_CAPSET:
		/* FALLTHROUGH */
	case LINAU_TYPE_MMAP:
		/* FALLTHROUGH */
	case LINAU_TYPE_NETFILTER_PKT:
		/* FALLTHROUGH */
	case LINAU_TYPE_NETFILTER_CFG:
		/* FALLTHROUGH */
	case LINAU_TYPE_SECCOMP:
		/* FALLTHROUGH */
	case LINAU_TYPE_PROCTITLE:
		/* FALLTHROUGH */
	case LINAU_TYPE_FEATURE_CHANGE:
		/* FALLTHROUGH */
	case LINAU_TYPE_AVC:
		/* FALLTHROUGH */
	case LINAU_TYPE_SELINUX_ERR:
		/* FALLTHROUGH */
	case LINAU_TYPE_AVC_PATH:
		/* FALLTHROUGH */
	case LINAU_TYPE_MAC_POLICY_LOAD:
		/* FALLTHROUGH */
	case LINAU_TYPE_MAC_STATUS:
		/* FALLTHROUGH */
	case LINAU_TYPE_MAC_CONFIG_CHANGE:
		/* FALLTHROUGH */
	case LINAU_TYPE_MAC_UNLBL_ALLOW:
		/* FALLTHROUGH */
	case LINAU_TYPE_MAC_CIPSOV4_ADD:
		/* FALLTHROUGH */
	case LINAU_TYPE_MAC_CIPSOV4_DEL:
		/* FALLTHROUGH */
	case LINAU_TYPE_MAC_MAP_ADD:
		/* FALLTHROUGH */
	case LINAU_TYPE_MAC_MAP_DEL:
		/* FALLTHROUGH */
	case LINAU_TYPE_MAC_IPSEC_ADDSA:
		/* FALLTHROUGH */
	case LINAU_TYPE_MAC_IPSEC_DELSA:
		/* FALLTHROUGH */
	case LINAU_TYPE_MAC_IPSEC_ADDSPD:
		/* FALLTHROUGH */
	case LINAU_TYPE_MAC_IPSEC_DELSPD:
		/* FALLTHROUGH */
	case LINAU_TYPE_MAC_IPSEC_EVENT:
		/* FALLTHROUGH */
	case LINAU_TYPE_MAC_UNLBL_STCADD:
		/* FALLTHROUGH */
	case LINAU_TYPE_MAC_UNLBL_STCDEL:
		/* FALLTHROUGH */
	case LINAU_TYPE_ANOM_PROMISCUOUS:
		/* FALLTHROUGH */
	case LINAU_TYPE_ANOM_ABEND:
		/* FALLTHROUGH */
	case LINAU_TYPE_ANOM_LINK:
		/* FALLTHROUGH */
	case LINAU_TYPE_INTEGRITY_DATA:
		/* FALLTHROUGH */
	case LINAU_TYPE_INTEGRITY_METADATA:
		/* FALLTHROUGH */
	case LINAU_TYPE_INTEGRITY_STATUS:
		/* FALLTHROUGH */
	case LINAU_TYPE_INTEGRITY_HASH:
		/* FALLTHROUGH */
	case LINAU_TYPE_INTEGRITY_PCR:
		/* FALLTHROUGH */
	case LINAU_TYPE_INTEGRITY_RULE:
		/* FALLTHROUGH */
	case LINAU_TYPE_AA:
		/* FALLTHROUGH */
	case LINAU_TYPE_APPARMOR_AUDIT:
		/* FALLTHROUGH */
	case LINAU_TYPE_APPARMOR_ALLOWED:
		/* FALLTHROUGH */
	case LINAU_TYPE_APPARMOR_DENIED:
		/* FALLTHROUGH */
	case LINAU_TYPE_APPARMOR_HINT:
		/* FALLTHROUGH */
	case LINAU_TYPE_APPARMOR_STATUS:
		/* FALLTHROUGH */
	case LINAU_TYPE_APPARMOR_ERROR:
		/* FALLTHROUGH */
	case LINAU_TYPE_KERNEL:
		/* FALLTHROUGH */
	case LINAU_TYPE_ANOM_LOGIN_FAILURES:
		/* FALLTHROUGH */
	case LINAU_TYPE_ANOM_LOGIN_TIME:
		/* FALLTHROUGH */
	case LINAU_TYPE_ANOM_LOGIN_SESSIONS:
		/* FALLTHROUGH */
	case LINAU_TYPE_ANOM_LOGIN_ACCT:
		/* FALLTHROUGH */
	case LINAU_TYPE_ANOM_LOGIN_LOCATION:
		/* FALLTHROUGH */
	case LINAU_TYPE_ANOM_MAX_DAC:
		/* FALLTHROUGH */
	case LINAU_TYPE_ANOM_MAX_MAC:
		/* FALLTHROUGH */
	case LINAU_TYPE_ANOM_AMTU_FAIL:
		/* FALLTHROUGH */
	case LINAU_TYPE_ANOM_RBAC_FAIL:
		/* FALLTHROUGH */
	case LINAU_TYPE_ANOM_RBAC_INTEGRITY_FAIL:
		/* FALLTHROUGH */
	case LINAU_TYPE_ANOM_CRYPTO_FAIL:
		/* FALLTHROUGH */
	case LINAU_TYPE_ANOM_ACCESS_FS:
		/* FALLTHROUGH */
	case LINAU_TYPE_ANOM_EXEC:
		/* FALLTHROUGH */
	case LINAU_TYPE_ANOM_MK_EXEC:
		/* FALLTHROUGH */
	case LINAU_TYPE_ANOM_ADD_ACCT:
		/* FALLTHROUGH */
	case LINAU_TYPE_ANOM_DEL_ACCT:
		/* FALLTHROUGH */
	case LINAU_TYPE_ANOM_MOD_ACCT:
		/* FALLTHROUGH */
	case LINAU_TYPE_ANOM_ROOT_TRANS:
		/* FALLTHROUGH */
	case LINAU_TYPE_RESP_ANOMALY:
		/* FALLTHROUGH */
	case LINAU_TYPE_RESP_ALERT:
		/* FALLTHROUGH */
	case LINAU_TYPE_RESP_KILL_PROC:
		/* FALLTHROUGH */
	case LINAU_TYPE_RESP_TERM_ACCESS:
		/* FALLTHROUGH */
	case LINAU_TYPE_RESP_ACCT_REMOTE:
		/* FALLTHROUGH */
	case LINAU_TYPE_RESP_ACCT_LOCK_TIMED:
		/* FALLTHROUGH */
	case LINAU_TYPE_RESP_ACCT_UNLOCK_TIMED:
		/* FALLTHROUGH */
	case LINAU_TYPE_RESP_ACCT_LOCK:
		/* FALLTHROUGH */
	case LINAU_TYPE_RESP_TERM_LOCK:
		/* FALLTHROUGH */
	case LINAU_TYPE_RESP_SEBOOL:
		/* FALLTHROUGH */
	case LINAU_TYPE_RESP_EXEC:
		/* FALLTHROUGH */
	case LINAU_TYPE_RESP_SINGLE:
		/* FALLTHROUGH */
	case LINAU_TYPE_RESP_HALT:
		/* FALLTHROUGH */
	case LINAU_TYPE_USER_ROLE_CHANGE:
		/* FALLTHROUGH */
	case LINAU_TYPE_ROLE_ASSIGN:
		/* FALLTHROUGH */
	case LINAU_TYPE_ROLE_REMOVE:
		/* FALLTHROUGH */
	case LINAU_TYPE_LABEL_OVERRIDE:
		/* FALLTHROUGH */
	case LINAU_TYPE_LABEL_LEVEL_CHANGE:
		/* FALLTHROUGH */
	case LINAU_TYPE_USER_LABELED_EXPORT:
		/* FALLTHROUGH */
	case LINAU_TYPE_USER_UNLABELED_EXPORT:
		/* FALLTHROUGH */
	case LINAU_TYPE_DEV_ALLOC:
		/* FALLTHROUGH */
	case LINAU_TYPE_DEV_DEALLOC:
		/* FALLTHROUGH */
	case LINAU_TYPE_FS_RELABEL:
		/* FALLTHROUGH */
	case LINAU_TYPE_USER_MAC_POLICY_LOAD:
		/* FALLTHROUGH */
	case LINAU_TYPE_ROLE_MODIFY:
		/* FALLTHROUGH */
	case LINAU_TYPE_USER_MAC_CONFIG_CHANGE:
		/* FALLTHROUGH */
	case LINAU_TYPE_CRYPTO_TEST_USER:
		/* FALLTHROUGH */
	case LINAU_TYPE_CRYPTO_PARAM_CHANGE_USER:
		/* FALLTHROUGH */
	case LINAU_TYPE_CRYPTO_LOGIN:
		/* FALLTHROUGH */
	case LINAU_TYPE_CRYPTO_LOGOUT:
		/* FALLTHROUGH */
	case LINAU_TYPE_CRYPTO_KEY_USER:
		/* FALLTHROUGH */
	case LINAU_TYPE_CRYPTO_FAILURE_USER:
		/* FALLTHROUGH */
	case LINAU_TYPE_CRYPTO_REPLAY_USER:
		/* FALLTHROUGH */
	case LINAU_TYPE_CRYPTO_SESSION:
		/* FALLTHROUGH */
	case LINAU_TYPE_CRYPTO_IKE_SA:
		/* FALLTHROUGH */
	case LINAU_TYPE_CRYPTO_IPSEC_SA:
		/* FALLTHROUGH */
	case LINAU_TYPE_VIRT_CONTROL:
		/* FALLTHROUGH */
	case LINAU_TYPE_VIRT_RESOURCE:
		/* FALLTHROUGH */
	case LINAU_TYPE_VIRT_MACHINE_ID:
		/* FALLTHROUGH */
	default:
		/*
		 * XXX Should default call PJDLOG_ABORT? If we cannot tell what
		 * kind of record we are dealing with it should be marked as
		 * LINAU_TYPE_UNDEFINED.
		 */
		tok = au_to_text(linau_record_get_text(record));
		PJDLOG_VERIFY(tok != NULL);
		PJDLOG_VERIFY(au_write(aurecordd, tok) == 0);
		break;
	}
}

static const char *
field_name_from_field_name_id(int fieldnameid)
{

	switch(fieldnameid) {
	case LINAU_FIELD_NAME_UNDEFINED:
		return (LINAU_FIELD_NAME_UNDEFINED_STR);
	case LINAU_FIELD_NAME_A0:
		return (LINAU_FIELD_NAME_A0_STR);
	case LINAU_FIELD_NAME_A1:
		return (LINAU_FIELD_NAME_A1_STR);
	case LINAU_FIELD_NAME_A2:
		return (LINAU_FIELD_NAME_A2_STR);
	case LINAU_FIELD_NAME_A3:
		return (LINAU_FIELD_NAME_A3_STR);
	case LINAU_FIELD_NAME_A_EXECVE_SYSCALL:
		/* XXX This case should be taken care of separately. */
		PJDLOG_ABORT("LINAU_FIELD_NAME_A_EXECVE_SYSCALL is not "
		    "implemented yet");
	case LINAU_FIELD_NAME_ACCT:
		return (LINAU_FIELD_NAME_ACCT_STR);
	case LINAU_FIELD_NAME_ACL:
		return (LINAU_FIELD_NAME_ACL_STR);
	case LINAU_FIELD_NAME_ACTION:
		return (LINAU_FIELD_NAME_ACTION_STR);
	case LINAU_FIELD_NAME_ADDED:
		return (LINAU_FIELD_NAME_ADDED_STR);
	case LINAU_FIELD_NAME_ADDR:
		return (LINAU_FIELD_NAME_ADDR_STR);
	case LINAU_FIELD_NAME_APPARMOR:
		return (LINAU_FIELD_NAME_APPARMOR_STR);
	case LINAU_FIELD_NAME_ARCH:
		return (LINAU_FIELD_NAME_ARCH_STR);
	case LINAU_FIELD_NAME_ARGC:
		return (LINAU_FIELD_NAME_ARGC_STR);
	case LINAU_FIELD_NAME_AUDIT_BACKLOG_LIMIT:
		return (LINAU_FIELD_NAME_AUDIT_BACKLOG_LIMIT_STR);
	case LINAU_FIELD_NAME_AUDIT_BACKLOG_WAIT_TIME:
		return (LINAU_FIELD_NAME_AUDIT_BACKLOG_WAIT_TIME_STR);
	case LINAU_FIELD_NAME_AUDIT_ENABLED:
		return (LINAU_FIELD_NAME_AUDIT_ENABLED_STR);
	case LINAU_FIELD_NAME_AUDIT_FAILURE:
		return (LINAU_FIELD_NAME_AUDIT_FAILURE_STR);
	case LINAU_FIELD_NAME_AUID:
		return (LINAU_FIELD_NAME_AUID_STR);
	case LINAU_FIELD_NAME_BANNERS:
		return (LINAU_FIELD_NAME_BANNERS_STR);
	case LINAU_FIELD_NAME_BOOL:
		return (LINAU_FIELD_NAME_BOOL_STR);
	case LINAU_FIELD_NAME_BUS:
		return (LINAU_FIELD_NAME_BUS_STR);
	case LINAU_FIELD_NAME_CAPABILITY:
		return (LINAU_FIELD_NAME_CAPABILITY_STR);
	case LINAU_FIELD_NAME_CAP_FE:
		return (LINAU_FIELD_NAME_CAP_FE_STR);
	case LINAU_FIELD_NAME_CAP_FI:
		return (LINAU_FIELD_NAME_CAP_FI_STR);
	case LINAU_FIELD_NAME_CAP_FP:
		return (LINAU_FIELD_NAME_CAP_FP_STR);
	case LINAU_FIELD_NAME_CAP_FVER:
		return (LINAU_FIELD_NAME_CAP_FVER_STR);
	case LINAU_FIELD_NAME_CAP_PE:
		return (LINAU_FIELD_NAME_CAP_PE_STR);
	case LINAU_FIELD_NAME_CAP_PI:
		return (LINAU_FIELD_NAME_CAP_PI_STR);
	case LINAU_FIELD_NAME_CAP_PP:
		return (LINAU_FIELD_NAME_CAP_PP_STR);
	case LINAU_FIELD_NAME_CATEGORY:
		return (LINAU_FIELD_NAME_CATEGORY_STR);
	case LINAU_FIELD_NAME_CGROUP:
		return (LINAU_FIELD_NAME_CGROUP_STR);
	case LINAU_FIELD_NAME_CHANGED:
		return (LINAU_FIELD_NAME_CHANGED_STR);
	case LINAU_FIELD_NAME_CIPHER:
		return (LINAU_FIELD_NAME_CIPHER_STR);
	case LINAU_FIELD_NAME_CLASS:
		return (LINAU_FIELD_NAME_CLASS_STR);
	case LINAU_FIELD_NAME_CMD:
		return (LINAU_FIELD_NAME_CMD_STR);
	case LINAU_FIELD_NAME_CODE:
		return (LINAU_FIELD_NAME_CODE_STR);
	case LINAU_FIELD_NAME_COMM:
		return (LINAU_FIELD_NAME_COMM_STR);
	case LINAU_FIELD_NAME_COMPAT:
		return (LINAU_FIELD_NAME_COMPAT_STR);
	case LINAU_FIELD_NAME_CWD:
		return (LINAU_FIELD_NAME_CWD_STR);
	case LINAU_FIELD_NAME_DADDR:
		return (LINAU_FIELD_NAME_DADDR_STR);
	case LINAU_FIELD_NAME_DATA:
		return (LINAU_FIELD_NAME_DATA_STR);
	case LINAU_FIELD_NAME_DEFAULT:
		return (LINAU_FIELD_NAME_DEFAULT_STR);
	case LINAU_FIELD_NAME_DEV:
		return (LINAU_FIELD_NAME_DEV_STR);
	/* case LINAU_FIELD_NAME2_DEV: */
	/*         return (LINAU_FIELD_NAME2_DEV_STR); */
	case LINAU_FIELD_NAME_DEVICE:
		return (LINAU_FIELD_NAME_DEVICE_STR);
	case LINAU_FIELD_NAME_DIR:
		return (LINAU_FIELD_NAME_DIR_STR);
	case LINAU_FIELD_NAME_DIRECTION:
		return (LINAU_FIELD_NAME_DIRECTION_STR);
	case LINAU_FIELD_NAME_DMAC:
		return (LINAU_FIELD_NAME_DMAC_STR);
	case LINAU_FIELD_NAME_DPORT:
		return (LINAU_FIELD_NAME_DPORT_STR);
	case LINAU_FIELD_NAME_EGID:
		return (LINAU_FIELD_NAME_EGID_STR);
	case LINAU_FIELD_NAME_ENFORCING:
		return (LINAU_FIELD_NAME_ENFORCING_STR);
	case LINAU_FIELD_NAME_ENTRIES:
		return (LINAU_FIELD_NAME_ENTRIES_STR);
	case LINAU_FIELD_NAME_EUID:
		return (LINAU_FIELD_NAME_EUID_STR);
	case LINAU_FIELD_NAME_EXE:
		return (LINAU_FIELD_NAME_EXE_STR);
	case LINAU_FIELD_NAME_EXIT:
		return (LINAU_FIELD_NAME_EXIT_STR);
	case LINAU_FIELD_NAME_FAM:
		return (LINAU_FIELD_NAME_FAM_STR);
	case LINAU_FIELD_NAME_FAMILY:
		return (LINAU_FIELD_NAME_FAMILY_STR);
	case LINAU_FIELD_NAME_FD:
		return (LINAU_FIELD_NAME_FD_STR);
	case LINAU_FIELD_NAME_FILE:
		return (LINAU_FIELD_NAME_FILE_STR);
	case LINAU_FIELD_NAME_FLAGS:
		return (LINAU_FIELD_NAME_FLAGS_STR);
	case LINAU_FIELD_NAME_FE:
		return (LINAU_FIELD_NAME_FE_STR);
	case LINAU_FIELD_NAME_FEATURE:
		return (LINAU_FIELD_NAME_FEATURE_STR);
	case LINAU_FIELD_NAME_FI:
		return (LINAU_FIELD_NAME_FI_STR);
	case LINAU_FIELD_NAME_FP:
		return (LINAU_FIELD_NAME_FP_STR);
	/* case LINAU_FIELD_NAME_FP2: */
	/*         return (LINAU_FIELD_NAME_FP2_STR); */
	case LINAU_FIELD_NAME_FORMAT:
		return (LINAU_FIELD_NAME_FORMAT_STR);
	case LINAU_FIELD_NAME_FSGID:
		return (LINAU_FIELD_NAME_FSGID_STR);
	case LINAU_FIELD_NAME_FSUID:
		return (LINAU_FIELD_NAME_FSUID_STR);
	case LINAU_FIELD_NAME_FVER:
		return (LINAU_FIELD_NAME_FVER_STR);
	case LINAU_FIELD_NAME_GID:
		return (LINAU_FIELD_NAME_GID_STR);
	case LINAU_FIELD_NAME_GRANTORS:
		return (LINAU_FIELD_NAME_GRANTORS_STR);
	case LINAU_FIELD_NAME_GRP:
		return (LINAU_FIELD_NAME_GRP_STR);
	case LINAU_FIELD_NAME_HOOK:
		return (LINAU_FIELD_NAME_HOOK_STR);
	case LINAU_FIELD_NAME_HOSTNAME:
		return (LINAU_FIELD_NAME_HOSTNAME_STR);
	case LINAU_FIELD_NAME_ICMP_TYPE:
		return (LINAU_FIELD_NAME_ICMP_TYPE_STR);
	case LINAU_FIELD_NAME_ID:
		return (LINAU_FIELD_NAME_ID_STR);
	case LINAU_FIELD_NAME_IGID:
		return (LINAU_FIELD_NAME_IGID_STR);
	case LINAU_FIELD_NAME_IMG:
		return (LINAU_FIELD_NAME_IMG_STR);
	case LINAU_FIELD_NAME_INIF:
		return (LINAU_FIELD_NAME_INIF_STR);
	case LINAU_FIELD_NAME_IP:
		return (LINAU_FIELD_NAME_IP_STR);
	case LINAU_FIELD_NAME_IPID:
		return (LINAU_FIELD_NAME_IPID_STR);
	case LINAU_FIELD_NAME_INO:
		return (LINAU_FIELD_NAME_INO_STR);
	case LINAU_FIELD_NAME_INODE:
		return (LINAU_FIELD_NAME_INODE_STR);
	case LINAU_FIELD_NAME_INODE_GID:
		return (LINAU_FIELD_NAME_INODE_GID_STR);
	case LINAU_FIELD_NAME_INODE_UID:
		return (LINAU_FIELD_NAME_INODE_UID_STR);
	case LINAU_FIELD_NAME_INVALID_CONTEXT:
		return (LINAU_FIELD_NAME_INVALID_CONTEXT_STR);
	case LINAU_FIELD_NAME_IPX:
		return (LINAU_FIELD_NAME_IPX_STR);
	case LINAU_FIELD_NAME_ITEM:
		return (LINAU_FIELD_NAME_ITEM_STR);
	case LINAU_FIELD_NAME_ITEMS:
		return (LINAU_FIELD_NAME_ITEMS_STR);
	case LINAU_FIELD_NAME_IUID:
		return (LINAU_FIELD_NAME_IUID_STR);
	case LINAU_FIELD_NAME_KERNEL:
		return (LINAU_FIELD_NAME_KERNEL_STR);
	case LINAU_FIELD_NAME_KEY:
		return (LINAU_FIELD_NAME_KEY_STR);
	case LINAU_FIELD_NAME_KIND:
		return (LINAU_FIELD_NAME_KIND_STR);
	case LINAU_FIELD_NAME_KSIZE:
		return (LINAU_FIELD_NAME_KSIZE_STR);
	case LINAU_FIELD_NAME_LADDR:
		return (LINAU_FIELD_NAME_LADDR_STR);
	case LINAU_FIELD_NAME_LEN:
		return (LINAU_FIELD_NAME_LEN_STR);
	case LINAU_FIELD_NAME_LPORT:
		return (LINAU_FIELD_NAME_LPORT_STR);
	case LINAU_FIELD_NAME_LIST:
		return (LINAU_FIELD_NAME_LIST_STR);
	case LINAU_FIELD_NAME_MAC:
		return (LINAU_FIELD_NAME_MAC_STR);
	case LINAU_FIELD_NAME_MACPROTO:
		return (LINAU_FIELD_NAME_MACPROTO_STR);
	case LINAU_FIELD_NAME_MAJ:
		return (LINAU_FIELD_NAME_MAJ_STR);
	case LINAU_FIELD_NAME_MAJOR:
		return (LINAU_FIELD_NAME_MAJOR_STR);
	case LINAU_FIELD_NAME_MINOR:
		return (LINAU_FIELD_NAME_MINOR_STR);
	case LINAU_FIELD_NAME_MODE:
		return (LINAU_FIELD_NAME_MODE_STR);
	case LINAU_FIELD_NAME_MODEL:
		return (LINAU_FIELD_NAME_MODEL_STR);
	case LINAU_FIELD_NAME_MSG:
		return (LINAU_FIELD_NAME_MSG_STR);
	case LINAU_FIELD_NAME_NARGS:
		return (LINAU_FIELD_NAME_NARGS_STR);
	case LINAU_FIELD_NAME_NAME:
		return (LINAU_FIELD_NAME_NAME_STR);
	case LINAU_FIELD_NAME_NAMETYPE:
		return (LINAU_FIELD_NAME_NAMETYPE_STR);
	case LINAU_FIELD_NAME_NET:
		return (LINAU_FIELD_NAME_NET_STR);
	case LINAU_FIELD_NAME_NEW:
		return (LINAU_FIELD_NAME_NEW_STR);
	case LINAU_FIELD_NAME_NEW_CHARDEV:
		return (LINAU_FIELD_NAME_NEW_CHARDEV_STR);
	case LINAU_FIELD_NAME_NEW_DISK:
		return (LINAU_FIELD_NAME_NEW_DISK_STR);
	case LINAU_FIELD_NAME_NEW_ENABLED:
		return (LINAU_FIELD_NAME_NEW_ENABLED_STR);
	case LINAU_FIELD_NAME_NEW_FS:
		return (LINAU_FIELD_NAME_NEW_FS_STR);
	case LINAU_FIELD_NAME_NEW_GID:
		return (LINAU_FIELD_NAME_NEW_GID_STR);
	case LINAU_FIELD_NAME_NEW_LEVEL:
		return (LINAU_FIELD_NAME_NEW_LEVEL_STR);
	case LINAU_FIELD_NAME_NEW_LOCK:
		return (LINAU_FIELD_NAME_NEW_LOCK_STR);
	case LINAU_FIELD_NAME_NEW_LOG_PASSWD:
		return (LINAU_FIELD_NAME_NEW_LOG_PASSWD_STR);
	case LINAU_FIELD_NAME_NEW_MEM:
		return (LINAU_FIELD_NAME_NEW_MEM_STR);
	case LINAU_FIELD_NAME_NEW_NET:
		return (LINAU_FIELD_NAME_NEW_NET_STR);
	case LINAU_FIELD_NAME_NEW_PE:
		return (LINAU_FIELD_NAME_NEW_PE_STR);
	case LINAU_FIELD_NAME_NEW_PI:
		return (LINAU_FIELD_NAME_NEW_PI_STR);
	case LINAU_FIELD_NAME_NEW_PP:
		return (LINAU_FIELD_NAME_NEW_PP_STR);
	case LINAU_FIELD_NAME_NEW_RANGE:
		return (LINAU_FIELD_NAME_NEW_RANGE_STR);
	case LINAU_FIELD_NAME_NEW_RNG:
		return (LINAU_FIELD_NAME_NEW_RNG_STR);
	case LINAU_FIELD_NAME_NEW_ROLE:
		return (LINAU_FIELD_NAME_NEW_ROLE_STR);
	case LINAU_FIELD_NAME_NEW_SEUSER:
		return (LINAU_FIELD_NAME_NEW_SEUSER_STR);
	case LINAU_FIELD_NAME_NEW_VCPU:
		return (LINAU_FIELD_NAME_NEW_VCPU_STR);
	case LINAU_FIELD_NAME_NLNK_FAM:
		return (LINAU_FIELD_NAME_NLNK_FAM_STR);
	case LINAU_FIELD_NAME_NLNK_GRP:
		return (LINAU_FIELD_NAME_NLNK_GRP_STR);
	case LINAU_FIELD_NAME_NLNK_PID:
		return (LINAU_FIELD_NAME_NLNK_PID_STR);
	case LINAU_FIELD_NAME_OAUID:
		return (LINAU_FIELD_NAME_OAUID_STR);
	case LINAU_FIELD_NAME_OBJ:
		return (LINAU_FIELD_NAME_OBJ_STR);
	case LINAU_FIELD_NAME_OBJ_GID:
		return (LINAU_FIELD_NAME_OBJ_GID_STR);
	case LINAU_FIELD_NAME_OBJ_UID:
		return (LINAU_FIELD_NAME_OBJ_UID_STR);
	case LINAU_FIELD_NAME_OFLAG:
		return (LINAU_FIELD_NAME_OFLAG_STR);
	case LINAU_FIELD_NAME_OGID:
		return (LINAU_FIELD_NAME_OGID_STR);
	case LINAU_FIELD_NAME_OCOMM:
		return (LINAU_FIELD_NAME_OCOMM_STR);
	case LINAU_FIELD_NAME_OLD:
		return (LINAU_FIELD_NAME_OLD_STR);
	/* case LINAU_FIELD_NAME2_OLD: */
	/*         return (LINAU_FIELD_NAME2_OLD_STR); */
	case LINAU_FIELD_NAME_OLD_AUID:
		return (LINAU_FIELD_NAME_OLD_AUID_STR);
	case LINAU_FIELD_NAME_OLD_CHARDEV:
		return (LINAU_FIELD_NAME_OLD_CHARDEV_STR);
	case LINAU_FIELD_NAME_OLD_DISK:
		return (LINAU_FIELD_NAME_OLD_DISK_STR);
	case LINAU_FIELD_NAME_OLD_ENABLED:
		return (LINAU_FIELD_NAME_OLD_ENABLED_STR);
	case LINAU_FIELD_NAME_OLD_ENFORCING:
		return (LINAU_FIELD_NAME_OLD_ENFORCING_STR);
	case LINAU_FIELD_NAME_OLD_FS:
		return (LINAU_FIELD_NAME_OLD_FS_STR);
	case LINAU_FIELD_NAME_OLD_LEVEL:
		return (LINAU_FIELD_NAME_OLD_LEVEL_STR);
	case LINAU_FIELD_NAME_OLD_LOCK:
		return (LINAU_FIELD_NAME_OLD_LOCK_STR);
	case LINAU_FIELD_NAME_OLD_LOG_PASSWD:
		return (LINAU_FIELD_NAME_OLD_LOG_PASSWD_STR);
	case LINAU_FIELD_NAME_OLD_MEM:
		return (LINAU_FIELD_NAME_OLD_MEM_STR);
	case LINAU_FIELD_NAME_OLD_NET:
		return (LINAU_FIELD_NAME_OLD_NET_STR);
	case LINAU_FIELD_NAME_OLD_PE:
		return (LINAU_FIELD_NAME_OLD_PE_STR);
	case LINAU_FIELD_NAME_OLD_PI:
		return (LINAU_FIELD_NAME_OLD_PI_STR);
	case LINAU_FIELD_NAME_OLD_PP:
		return (LINAU_FIELD_NAME_OLD_PP_STR);
	case LINAU_FIELD_NAME_OLD_PROM:
		return (LINAU_FIELD_NAME_OLD_PROM_STR);
	case LINAU_FIELD_NAME_OLD_RANGE:
		return (LINAU_FIELD_NAME_OLD_RANGE_STR);
	case LINAU_FIELD_NAME_OLD_RNG:
		return (LINAU_FIELD_NAME_OLD_RNG_STR);
	case LINAU_FIELD_NAME_OLD_ROLE:
		return (LINAU_FIELD_NAME_OLD_ROLE_STR);
	case LINAU_FIELD_NAME_OLD_SES:
		return (LINAU_FIELD_NAME_OLD_SES_STR);
	case LINAU_FIELD_NAME_OLD_SEUSER:
		return (LINAU_FIELD_NAME_OLD_SEUSER_STR);
	case LINAU_FIELD_NAME_OLD_VAL:
		return (LINAU_FIELD_NAME_OLD_VAL_STR);
	case LINAU_FIELD_NAME_OLD_VCPU:
		return (LINAU_FIELD_NAME_OLD_VCPU_STR);
	case LINAU_FIELD_NAME_OP:
		return (LINAU_FIELD_NAME_OP_STR);
	case LINAU_FIELD_NAME_OPID:
		return (LINAU_FIELD_NAME_OPID_STR);
	case LINAU_FIELD_NAME_OSES:
		return (LINAU_FIELD_NAME_OSES_STR);
	case LINAU_FIELD_NAME_OUID:
		return (LINAU_FIELD_NAME_OUID_STR);
	case LINAU_FIELD_NAME_OUTIF:
		return (LINAU_FIELD_NAME_OUTIF_STR);
	case LINAU_FIELD_NAME_PARENT:
		return (LINAU_FIELD_NAME_PARENT_STR);
	case LINAU_FIELD_NAME_PATH:
		return (LINAU_FIELD_NAME_PATH_STR);
	case LINAU_FIELD_NAME_PER:
		return (LINAU_FIELD_NAME_PER_STR);
	case LINAU_FIELD_NAME_PERM:
		return (LINAU_FIELD_NAME_PERM_STR);
	case LINAU_FIELD_NAME_PERM_MASK:
		return (LINAU_FIELD_NAME_PERM_MASK_STR);
	case LINAU_FIELD_NAME_PERMISSIVE:
		return (LINAU_FIELD_NAME_PERMISSIVE_STR);
	case LINAU_FIELD_NAME_PFS:
		return (LINAU_FIELD_NAME_PFS_STR);
	case LINAU_FIELD_NAME_PID:
		return (LINAU_FIELD_NAME_PID_STR);
	case LINAU_FIELD_NAME_PPID:
		return (LINAU_FIELD_NAME_PPID_STR);
	case LINAU_FIELD_NAME_PRINTER:
		return (LINAU_FIELD_NAME_PRINTER_STR);
	case LINAU_FIELD_NAME_PROM:
		return (LINAU_FIELD_NAME_PROM_STR);
	case LINAU_FIELD_NAME_PROCTITLE:
		return (LINAU_FIELD_NAME_PROCTITLE_STR);
	case LINAU_FIELD_NAME_PROTO:
		return (LINAU_FIELD_NAME_PROTO_STR);
	case LINAU_FIELD_NAME_QBYTES:
		return (LINAU_FIELD_NAME_QBYTES_STR);
	case LINAU_FIELD_NAME_RANGE:
		return (LINAU_FIELD_NAME_RANGE_STR);
	case LINAU_FIELD_NAME_RDEV:
		return (LINAU_FIELD_NAME_RDEV_STR);
	case LINAU_FIELD_NAME_REASON:
		return (LINAU_FIELD_NAME_REASON_STR);
	case LINAU_FIELD_NAME_REMOVED:
		return (LINAU_FIELD_NAME_REMOVED_STR);
	case LINAU_FIELD_NAME_RES:
		return (LINAU_FIELD_NAME_RES_STR);
	case LINAU_FIELD_NAME_RESRC:
		return (LINAU_FIELD_NAME_RESRC_STR);
	case LINAU_FIELD_NAME_RESULT:
		return (LINAU_FIELD_NAME_RESULT_STR);
	case LINAU_FIELD_NAME_ROLE:
		return (LINAU_FIELD_NAME_ROLE_STR);
	case LINAU_FIELD_NAME_RPORT:
		return (LINAU_FIELD_NAME_RPORT_STR);
	case LINAU_FIELD_NAME_SADDR:
		return (LINAU_FIELD_NAME_SADDR_STR);
	case LINAU_FIELD_NAME_SAUID:
		return (LINAU_FIELD_NAME_SAUID_STR);
	case LINAU_FIELD_NAME_SCONTEXT:
		return (LINAU_FIELD_NAME_SCONTEXT_STR);
	case LINAU_FIELD_NAME_SELECTED:
		return (LINAU_FIELD_NAME_SELECTED_STR);
	case LINAU_FIELD_NAME_SEPERM:
		return (LINAU_FIELD_NAME_SEPERM_STR);
	case LINAU_FIELD_NAME_SEQNO:
		return (LINAU_FIELD_NAME_SEQNO_STR);
	case LINAU_FIELD_NAME_SEPERMS:
		return (LINAU_FIELD_NAME_SEPERMS_STR);
	case LINAU_FIELD_NAME_SERESULT:
		return (LINAU_FIELD_NAME_SERESULT_STR);
	case LINAU_FIELD_NAME_SES:
		return (LINAU_FIELD_NAME_SES_STR);
	case LINAU_FIELD_NAME_SEUSER:
		return (LINAU_FIELD_NAME_SEUSER_STR);
	case LINAU_FIELD_NAME_SGID:
		return (LINAU_FIELD_NAME_SGID_STR);
	case LINAU_FIELD_NAME_SIG:
		return (LINAU_FIELD_NAME_SIG_STR);
	case LINAU_FIELD_NAME_SIGEV_SIGNO:
		return (LINAU_FIELD_NAME_SIGEV_SIGNO_STR);
	case LINAU_FIELD_NAME_SMAC:
		return (LINAU_FIELD_NAME_SMAC_STR);
	case LINAU_FIELD_NAME_SPID:
		return (LINAU_FIELD_NAME_SPID_STR);
	case LINAU_FIELD_NAME_SPORT:
		return (LINAU_FIELD_NAME_SPORT_STR);
	case LINAU_FIELD_NAME_STATE:
		return (LINAU_FIELD_NAME_STATE_STR);
	case LINAU_FIELD_NAME_SUBJ:
		return (LINAU_FIELD_NAME_SUBJ_STR);
	case LINAU_FIELD_NAME_SUCCESS:
		return (LINAU_FIELD_NAME_SUCCESS_STR);
	case LINAU_FIELD_NAME_SUID:
		return (LINAU_FIELD_NAME_SUID_STR);
	case LINAU_FIELD_NAME_SYSCALL:
		return (LINAU_FIELD_NAME_SYSCALL_STR);
	case LINAU_FIELD_NAME_TABLE:
		return (LINAU_FIELD_NAME_TABLE_STR);
	case LINAU_FIELD_NAME_TCLASS:
		return (LINAU_FIELD_NAME_TCLASS_STR);
	case LINAU_FIELD_NAME_TCONTEXT:
		return (LINAU_FIELD_NAME_TCONTEXT_STR);
	case LINAU_FIELD_NAME_TERMINAL:
		return (LINAU_FIELD_NAME_TERMINAL_STR);
	case LINAU_FIELD_NAME_TTY:
		return (LINAU_FIELD_NAME_TTY_STR);
	case LINAU_FIELD_NAME_TYPE:
		return (LINAU_FIELD_NAME_TYPE_STR);
	case LINAU_FIELD_NAME_UID:
		return (LINAU_FIELD_NAME_UID_STR);
	case LINAU_FIELD_NAME_UNIT:
		return (LINAU_FIELD_NAME_UNIT_STR);
	case LINAU_FIELD_NAME_URI:
		return (LINAU_FIELD_NAME_URI_STR);
	case LINAU_FIELD_NAME_USER:
		return (LINAU_FIELD_NAME_USER_STR);
	case LINAU_FIELD_NAME_UUID:
		return (LINAU_FIELD_NAME_UUID_STR);
	case LINAU_FIELD_NAME_VAL:
		return (LINAU_FIELD_NAME_VAL_STR);
	case LINAU_FIELD_NAME_VER:
		return (LINAU_FIELD_NAME_VER_STR);
	case LINAU_FIELD_NAME_VIRT:
		return (LINAU_FIELD_NAME_VIRT_STR);
	case LINAU_FIELD_NAME_VM:
		return (LINAU_FIELD_NAME_VM_STR);
	case LINAU_FIELD_NAME_VM_CTX:
		return (LINAU_FIELD_NAME_VM_CTX_STR);
	case LINAU_FIELD_NAME_VM_PID:
		return (LINAU_FIELD_NAME_VM_PID_STR);
	case LINAU_FIELD_NAME_WATCH:
		return (LINAU_FIELD_NAME_WATCH_STR);
	default:
		PJDLOG_ABORT("Field name should be marked as "
		    "LINAU_FIELD_NAME_UNDEFINED if "
		    "it is not a standard name");
	}
}

static uint32_t
extract_uint32(const char *buf, size_t start, size_t end)
{
	char *numstr;
	size_t len;
	uint32_t num;

	PJDLOG_ASSERT(buf != NULL);
	PJDLOG_ASSERT(start <= end);

	PJDLOG_ASSERT(isdigit(buf[start]) != 0);
	PJDLOG_ASSERT(isdigit(buf[end]) != 0);

	len = end - start + 1;
	numstr = extract_substring(buf, start, len);
	num = string_to_uint32(numstr);

	return (num);
}

static uint32_t
string_to_uint32(const char *str)
{
	char *endp;
	uint32_t num;

	PJDLOG_ASSERT(str != NULL);

	pjdlog_debug(6, " . . >> string_to_uint32");

	errno = 0;
	num = (uint32_t)strtoul(str, &endp, 10);

	PJDLOG_VERIFY(str != endp);
	PJDLOG_VERIFY(*endp == '\0');
	PJDLOG_VERIFY(num != 0 || errno == 0);

	return (num);
}

struct linau_record *
linau_record_create(void)
{
	struct linau_record *record;

	record = calloc(1, sizeof(*record));
	PJDLOG_VERIFY(record != NULL);

	return (record);
}

void
linau_record_destroy(struct linau_record *record)
{

	PJDLOG_ASSERT(record != NULL);

	free(record->lr_type);

	free(record->lr_text);

	nvlist_destroy(record->lr_fields);

	free(record);
}

bool
linau_record_exists_field(const struct linau_record *record, const char *name)
{
	nvlist_t *fields;

	PJDLOG_ASSERT(record != NULL);
	PJDLOG_ASSERT(record->lr_fields != NULL);
	PJDLOG_ASSERT(name != NULL);

	fields = linau_record_get_fields(record);

	return (nvlist_exists_string(fields, name));
}

const char *
linau_record_get_field(const struct linau_record *record, const char *name)
{
	nvlist_t *fields;

	PJDLOG_ASSERT(record != NULL);
	PJDLOG_ASSERT(name != NULL);
	PJDLOG_ASSERT(record->lr_fields != NULL);

	/* XXX Return NULL or exit? */
	/* if (!linau_record_exists_field(record, name)) */
	/*         return (NULL); */
	PJDLOG_VERIFY(linau_record_exists_field(record, name));


	fields = linau_record_get_fields(record);

	return (nvlist_get_string(fields, name));
}

nvlist_t *
linau_record_get_fields(const struct linau_record *record)
{

	PJDLOG_ASSERT(record != NULL);

	return (record->lr_fields);
}

uint32_t
linau_record_get_id(const struct linau_record *record)
{

	PJDLOG_ASSERT(record != NULL);

	return (record->lr_id);
}

const char *
linau_record_get_text(const struct linau_record *record)
{

	PJDLOG_ASSERT(record != NULL);
	PJDLOG_ASSERT(record->lr_text != NULL);

	return (record->lr_text);
}

uint64_t
linau_record_get_time(const struct linau_record *record)
{

	PJDLOG_ASSERT(record != NULL);

	return (record->lr_time);
}

const char *
linau_record_get_type(const struct linau_record *record)
{

	PJDLOG_ASSERT(record != NULL);

	return (record->lr_type);
}

void
linau_record_move_fields(struct linau_record *record, nvlist_t *fields)
{

	PJDLOG_ASSERT(record != NULL);
	PJDLOG_ASSERT(fields != NULL);

	record->lr_fields = fields;
}

void
linau_record_set_id(struct linau_record *record, uint32_t id)
{

	PJDLOG_ASSERT(record != NULL);

	record->lr_id = id;
}

void
linau_record_set_text(struct linau_record *record, const char *text)
{
	size_t len;

	PJDLOG_ASSERT(record != NULL);
	PJDLOG_ASSERT(text != NULL);
	PJDLOG_ASSERT(strchr(text, '\0') != NULL);

	len = strlen(text);

	record->lr_text = malloc(sizeof(*record->lr_text) * (len + 1));
	PJDLOG_VERIFY(record->lr_text != NULL);

	PJDLOG_VERIFY(strlcpy(record->lr_text, text, len + 1) == len);
}

void
linau_record_set_time(struct linau_record *record, uint64_t time)
{

	PJDLOG_ASSERT(record != NULL);

	record->lr_time = time;
}

void
linau_record_move_type(struct linau_record *record, char *type)
{

	PJDLOG_ASSERT(record != NULL);
	PJDLOG_ASSERT(type != NULL);

	record->lr_type = type;
}

/*
 * data must be a null-terminated string.
 * The function doesn't require data to have/not have a trailing newline.
 */
struct linau_record *
linau_record_parse(const char *buf)
{
	struct linau_record *record;

	PJDLOG_ASSERT(buf != NULL);
	PJDLOG_ASSERT(strchr(buf, '\0') != NULL);

	pjdlog_debug(3, " . . + linau_record_parse");

	record = linau_record_create();

	linau_record_move_type(record, linau_record_parse_type(buf));
	linau_record_set_id(record, linau_record_parse_id(buf));
	linau_record_set_time(record, linau_record_parse_time(buf));
	linau_record_move_fields(record, linau_record_parse_fields(buf));
	linau_record_set_text(record, buf);

	pjdlog_debug(3, " . . . > id (%u), time (%ju)",
	    linau_record_get_id(record), linau_record_get_time(record));

	pjdlog_debug(3, " . . -");

	return (record);
}

uint32_t
linau_record_parse_id(const char *buf)
{
	size_t idpos;
	size_t msgend;
	size_t msgstart;
	size_t nsecspos;
	size_t secspos;
	uint32_t id;

	PJDLOG_ASSERT(buf != NULL);
	PJDLOG_ASSERT(strchr(buf, '\0') != NULL);

	pjdlog_debug(5, " . . . . + linau_record_parse_id");

	locate_msg(buf, &msgstart, &secspos, &nsecspos, &idpos, &msgend);

	id = extract_uint32(buf, idpos, msgend - 1);

	pjdlog_debug(5, " . . . . . id (%zu)", id);

	pjdlog_debug(5, " . . . . -");

	return (id);
}

nvlist_t *
linau_record_parse_fields(const char *buf)
{
	size_t buflen;
	size_t lastpos;
	size_t msgend;
	struct linau_field *field;
	nvlist_t *fields;

	PJDLOG_ASSERT(buf != NULL);
	PJDLOG_ASSERT(strchr(buf, '\0') != NULL);

	pjdlog_debug(5, " . . . . + linau_record_parse_fields");

	buflen = strlen(buf);

	/*
	 * XXX NV_FLAG_NO_UNIQUE is currently not supported because I cannot
	 * link the new library.
	 */
	/* fields = nvlist_create(NV_FLAG_NO_UNIQUE); */
	fields = nvlist_create(0);
	/* XXX Do we need this VERIFY? */
	PJDLOG_VERIFY(fields != NULL);

	/* Find the beginning of the field section. */
	PJDLOG_VERIFY(find_position(&msgend, buf, 0, ')'));
	PJDLOG_ASSERT(buf[msgend] == ')');
	PJDLOG_ASSERT(buf[msgend + 1] == ':');
	PJDLOG_ASSERT(buf[msgend + 2] == ' ');

	lastpos = msgend + 2;
	pjdlog_debug(5, " . . . . . lastpos (%zu)", lastpos);

	/* While not all bytes of the buf are processed. */
	while (lastpos < buflen) {
		field = NULL;

		field = linau_field_parse(buf, &lastpos);
		PJDLOG_ASSERT(field != NULL);

		/* Append the field to the fields list. */
		nvlist_move_string(fields, field->lf_name, field->lf_value);

		linau_field_shallow_destroy(field);
	}

	pjdlog_debug(5, " . . . . -");

	return (fields);
}

uint64_t
linau_record_parse_time(const char *buf)
{
	uint64_t time;
	size_t idpos;
	size_t msgend;
	size_t msgstart;
	size_t nsecspos;
	size_t secspos;
	uint32_t nsecs;
	uint32_t secs;

	PJDLOG_ASSERT(buf != NULL);
	PJDLOG_ASSERT(strchr(buf, '\0') != NULL);

	pjdlog_debug(5, " . . . . + linau_record_parse_time");

	locate_msg(buf, &msgstart, &secspos, &nsecspos, &idpos, &msgend);

	/* Set the id field. */
	secs = extract_uint32(buf, secspos, nsecspos - 2);
	nsecs = extract_uint32(buf, nsecspos, idpos - 2);

	time = combine_secs_with_nsecs(secs, nsecs);

	pjdlog_debug(5, " . . . . -");

	return (time);
}

char *
linau_record_parse_type(const char *buf)
{
	char *type;
	char *typenextspace;
	const char *typeprefix;
	size_t typeend;
	size_t typelen;
	size_t typenextspacepos;
	size_t typeprefixlen;
	size_t typestart;

	PJDLOG_ASSERT(buf != NULL);
	PJDLOG_ASSERT(strchr(buf, '\0'));

	pjdlog_debug(4, " . . . + linau_record_parse_type");

	typeprefix = "type";
	typeprefixlen = strlen(typeprefix);

	/* XXX Does it make sense? */
	PJDLOG_ASSERT(typeprefixlen + 2 < strlen(buf));
	pjdlog_debug(4, " . . . . (%.*s), (%.*s)",
	    typeprefixlen, buf, typeprefixlen, typeprefix);
	PJDLOG_VERIFY(strncmp(buf, typeprefix, typeprefixlen) == 0);

	typestart = typeprefixlen + 1;

	PJDLOG_ASSERT(typestart < strlen(buf));
	PJDLOG_ASSERT(isprint(buf[typestart]) != 0);

	typenextspace = strchr(buf + typestart, ' ');
	PJDLOG_VERIFY(typenextspace != NULL);
	typenextspacepos = typenextspace - buf;
	typeend = typenextspacepos - 1;
	PJDLOG_ASSERT(typestart <= typeend);
	PJDLOG_ASSERT(buf[typeend] != ' ');

	typelen = typeend - typestart + 1;
	pjdlog_debug(4, " . . . . Raw type: (%zu) (%.*s)", typelen,
	    (int)typelen, buf + typestart);

	type = extract_substring(buf, typestart, typelen);

	pjdlog_debug(4, " . . . -");

	return (type);
}

/*
 * I assume that every legal text file ends up with a newline.
 *
 * Returns NULL on EOF.
 */
struct linau_record *
linau_record_fetch(FILE *fp)
{
	char *data;
	struct sbuf *inbuf;
	char rawbuf[BSMCONV_LINAU_RECORD_INPUT_BUFFER_SIZE];
	struct linau_record *record;
	size_t buflen;

	PJDLOG_ASSERT(fp != NULL);

	pjdlog_debug(3, " . . + linau_record_fetch");

	inbuf = sbuf_new_auto();
	PJDLOG_VERIFY(inbuf != NULL);

	do {
		errno = 0;

		if (fgets(rawbuf, sizeof(rawbuf), fp) == NULL) {
			PJDLOG_VERIFY(errno == 0);
			pjdlog_debug(3, " . . . EOF");
			sbuf_delete(inbuf);
			return NULL; /* EOF */
		}

		pjdlog_debug(3, " . . . rawbuf: (%s)", rawbuf);
		PJDLOG_VERIFY(sbuf_cat(inbuf, rawbuf) == 0);
	} while (strstr(rawbuf, "\n\0") == NULL);

	PJDLOG_VERIFY(sbuf_finish(inbuf) == 0);

	/* Check if the last record is valid (has a terminating newline). */
	PJDLOG_ASSERT(sbuf_len(inbuf) != -1);
	buflen = sbuf_len(inbuf);
	data = sbuf_data(inbuf);
	pjdlog_debug(3, " . . . buflen: (%zu)", buflen);
	/* XXX Assert or verify? This is a vital assumption. */
	PJDLOG_VERIFY(strcmp(data + (buflen - 1), "\n\0") == 0);

	/* Remove the trailing newline. */
	data[buflen - 1] = '\0';

	pjdlog_debug(3, " . . . Read record: (%s)", data);

	record = linau_record_parse(data);

	pjdlog_debug(3, " . . -");

	return (record);
}

/*
 * Compare the records' timestamps and ids.
 *
 * The logic follows the follwing pattern:
 * - Compare by the times and return either 1 or -1 if they differ;
 * - Compare by the ids and return either 1 or -1 if they differ;
 * - Return 0 if both times and ids matches.
 *
 * Returns -1 if reca seems to be earlier in terms of the time and the id
 * and 1 if recb seems to be earlier. 0 if the time and the ids are the
 * same.
 */
int
linau_record_comapre_origin(const struct linau_record *reca,
    const struct linau_record *recb)
{
	uint64_t recatime;
	uint64_t recbtime;
	uint32_t recaid;
	uint32_t recbid;

	PJDLOG_ASSERT(reca != NULL);
	PJDLOG_ASSERT(recb != NULL);

	recatime = linau_record_get_time(reca);
	recbtime = linau_record_get_time(recb);
	recaid = linau_record_get_id(reca);
	recbid = linau_record_get_id(recb);

	return (linau_proto_compare_origin(recaid, recatime, recbid, recbtime));
}

void
linau_record_to_au(const struct linau_record *record, int aurecordd)
{
	int typenum;

	PJDLOG_ASSERT(record != NULL);
	PJDLOG_ASSERT(record->lr_type != NULL);
	PJDLOG_ASSERT(record->lr_fields != NULL);
	PJDLOG_ASSERT(aurecordd >= 0);

	/* Get the identification number of the type. */
	typenum = get_linau_type_num(linau_record_get_type(record));

	/* Generate a token. */
	convert_to_au(aurecordd, record, typenum);
}
